apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
    name: aws-secret-store
    namespace: ecommerce-vti
spec:
    provider:
        aws:
            service: SecretsManager
            region: us-east-1
            auth:
                jwt:
                    serviceAccountRef:
                        name: external-secrets-sa
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
    name: backend-secrets
    namespace: ecommerce-vti
spec:
    refreshInterval: 1h
    secretStoreRef:
        name: aws-secret-store
        kind: SecretStore
    target:
        name: backend-secrets
        creationPolicy: Owner
        template:
            type: Opaque
            # Automatically map all properties from AWS Secret as environment variables
    dataFrom:
        - extract:
              key: "BACKEND_SECRETS_NAME"
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
    name: frontend-secrets
    namespace: ecommerce-vti
spec:
    refreshInterval: 1h
    secretStoreRef:
        name: aws-secret-store
        kind: SecretStore
    target:
        name: frontend-secrets
        creationPolicy: Owner
        template:
            type: Opaque
    dataFrom:
        - extract:
              key: "FRONTEND_SECRETS_NAME"
