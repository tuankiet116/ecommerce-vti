apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
    name: aws-secret-store
    namespace: ecommerce-vti
spec:
    provider:
        aws:
            service: SecretsManager
            region: ap-southeast-2
            auth:
                jwt:
                    serviceAccountRef:
                        name: external-secrets-sa
---
# Backend Secrets (includes database, cache, API keys, app secrets)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
    name: backend-secrets
    namespace: ecommerce-vti
spec:
    refreshInterval: 1h
    secretStoreRef:
        name: aws-secret-store
        kind: SecretStore
    target:
        name: backend-secrets
        creationPolicy: Owner
        template:
            type: Opaque
    dataFrom:
        - extract:
              key: "BACKEND_SECRETS_NAME"
---
# Frontend Secrets (public API keys, endpoints)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
    name: frontend-secrets
    namespace: ecommerce-vti
spec:
    refreshInterval: 1h
    secretStoreRef:
        name: aws-secret-store
        kind: SecretStore
    target:
        name: frontend-secrets
        creationPolicy: Owner
        template:
            type: Opaque
    dataFrom:
        - extract:
              key: "FRONTEND_SECRETS_NAME"
